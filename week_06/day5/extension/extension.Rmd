---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
transactions <- read_csv("data/online_retail_subset.csv")
head(transactions, 20)
```

For the first section we are interested in the purchase of two particular items:

item A - ‘HEART OF WICKER SMALL’ (StockCode 22469)
item B - ‘LARGE CAKE TOWEL PINK SPOTS’ (StockCode 21110)

Calculate the support for item A (this will be the support for a single item).
```{r}
a_prob <- transactions %>% 
  filter(StockCode == "22469") %>% 
  summarise(support_a = n() / nrow(transactions))

a_prob
```

Calculate the support and confidence for rule (A→B).
```{r}
a_b_prob <- transactions %>% 
  filter(StockCode == "22469" | StockCode == "21110") %>% 
  summarise(support_a_b = n() / nrow(transactions))

a_b_prob

confidence <- a_b_prob$support_a_b / a_prob$support_a

confidence
```
Calculate the lift for (A→B)
 [Hint - you will need to calculate the support for B]
```{r}
b_prob <- transactions %>% 
  filter(StockCode == "21110") %>% 
  summarise(support_b = n() / nrow(transactions))

b_prob

lift <- a_b_prob$support_a_b/(a_prob$support_a * b_prob$support_b)
lift
```
Items are very likely to be bought together.

```{r}
library(arules)
library(arulesViz)
```

```{r}
transactions_reformat <- transactions %>%
  select(InvoiceNo, Description) %>%
  na.omit()

write_csv(transactions_reformat, "transactions_reformat.csv")

apriori_format <- read.transactions("transactions_reformat.csv", format = "single", sep = ",", header = TRUE, cols = c("InvoiceNo", "Description"))
```
```{r}
inspect(head(apriori_format))
```
```{r}
itemFrequencyPlot(apriori_format,topN=20,type="absolute")
```
```{r}
rules <- apriori(apriori_format, parameter = list(supp = 0.009, conf = 0.8))
 
options(digits=2)
inspect(rules[1:5])
```
```{r}
rules<-sort(rules, by="confidence", decreasing=TRUE)
rules
```
```{r}
plot(rules,method="graph",interactive=TRUE,shading=NA)
```


